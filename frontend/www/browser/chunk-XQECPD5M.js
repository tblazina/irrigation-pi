import{a as w,b as le}from"./chunk-VISD66XU.js";import"./chunk-FNLJE7QV.js";import{$ as A,A as I,Ea as te,Fa as ie,G as l,H as k,I as x,Ia as ne,J as O,Ja as re,L as N,La as oe,M as R,Ma as ae,N as B,O as D,P as V,T as j,Z as s,_ as M,a as b,aa as G,ba as v,ca as $,da as q,ea as L,f as P,ga as H,ha as z,j as T,ka as J,ma as K,na as Q,pa as U,q as u,qa as W,r as h,ra as X,s as y,sa as Y,t as g,w as n,wa as Z,x as o,xa as ee,y as _}from"./chunk-XX3QOINY.js";import"./chunk-FVSUARKE.js";import"./chunk-NA2OGXLT.js";import"./chunk-GHOA5HSF.js";import"./chunk-SZCERZCG.js";import"./chunk-G3CV3VGG.js";import"./chunk-GFTFUPMB.js";import"./chunk-C4ZWKFGK.js";import"./chunk-F6OOB4LP.js";import"./chunk-4U6PRYVA.js";import"./chunk-6O5TN2LV.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{a as S,e as i,f as F}from"./chunk-PG5KTQWO.js";var de=a=>S({start_time:"12:00",duration:10,repeat:"every_day",active:!0,relay_position:1},a);function se(a,m){a&1&&(n(0,"div",12),l(1," Start time has wrong format. "),o())}function me(a,m){a&1&&(n(0,"div",12),l(1," Please enter a positive integer. "),o())}function ue(a,m){a&1&&(n(0,"div",12),l(1," Please enter a positive integer. "),o())}var ke=(()=>{let m=class m{constructor(t,r,e,d,c,E){i(this,"activatedRoute");i(this,"scheduleService");i(this,"cdr");i(this,"pickerCtrl");i(this,"toastController");i(this,"navController");i(this,"id",null);i(this,"addEditForm");i(this,"repeatOptions");i(this,"hourOptions");i(this,"minuteOptions");i(this,"cancelButton",{text:"Cancel",role:"cancel"});i(this,"repeatValues",["every_day","weekdays","weekends","monday","tuesday","wednesday","thursday","friday","saturday","sunday"]);i(this,"displayStringPipe");this.activatedRoute=t,this.scheduleService=r,this.cdr=e,this.pickerCtrl=d,this.toastController=c,this.navController=E,this.displayStringPipe=new w,this.repeatOptions=this.repeatValues.map(p=>({text:this.displayStringPipe.transform(p),value:p})),this.hourOptions=[...Array(24)].map((p,C)=>{let f=String(C).padStart(2,"0");return{text:f,value:f}}),this.minuteOptions=[...Array(60)].map((p,C)=>{let f=String(C).padStart(2,"0");return{text:f,value:f}}),this.addEditForm=new G({start_time:new v("",[s.required,s.pattern("^[0-9]{1,2}:[0-9]{1,2}$")]),duration:new v(1,[s.min(1),s.required,s.pattern("^[0-9]+$")]),repeat:new v("every_day",s.required),active:new v(!0,s.required),relay_position:new v(1,[s.min(1),s.pattern("^[0-9]+$")])})}ngOnInit(){this.id=parseInt(this.activatedRoute.snapshot.paramMap.get("id")),b(de()).pipe(P(t=>this.id?this.scheduleService.getSchedule(this.id):b(t))).subscribe(t=>{this.addEditForm.patchValue(t),this.cdr.detectChanges()})}openRepeatPicker(){return F(this,null,function*(){let t=yield this.pickerCtrl.create({columns:[{name:"repeat",options:this.repeatOptions}],buttons:[S({},this.cancelButton),{text:"Confirm",handler:r=>{this.addEditForm.patchValue({repeat:r.repeat.value}),this.cdr.detectChanges()}}]});(yield t.getColumn("repeat")).selectedIndex=this.repeatOptions.map(({value:r})=>r).findIndex(r=>{var e,d,c;return r===((c=(d=(e=this.addEditForm)==null?void 0:e.controls)==null?void 0:d.repeat)==null?void 0:c.value)}),yield t.present()})}openStartTimePicker(){return F(this,null,function*(){var e,d,c,E;let t=yield this.pickerCtrl.create({columns:[{name:"hour",options:this.hourOptions},{name:"minute",options:this.minuteOptions}],buttons:[S({},this.cancelButton),{text:"Confirm",handler:p=>{this.addEditForm.patchValue({start_time:`${p.hour.value}:${p.minute.value}`}),this.cdr.detectChanges()}}]}),r=(E=(c=(d=(e=this.addEditForm)==null?void 0:e.controls)==null?void 0:d.start_time)==null?void 0:c.value)==null?void 0:E.match(/^([0-9]{1,2}):([0-9]{1,2})/);r&&((yield t.getColumn("hour")).selectedIndex=parseInt(r[1]),(yield t.getColumn("minute")).selectedIndex=parseInt(r[2])),yield t.present()})}onSubmit(){if(this.addEditForm.status==="VALID"){let t;this.id?t=this.scheduleService.updateSchedule(this.id,this.addEditForm.value):t=this.scheduleService.createSchedule(this.addEditForm.value),t.subscribe(()=>{this.navController.navigateBack(["schedules"]).catch(()=>{})})}else this.toastController.create({message:"Please check your input and try again",duration:3e3,color:"danger",position:"bottom"}).then(t=>t.present()).catch(()=>{})}};i(m,"\u0275fac",function(r){return new(r||m)(h(j),h(le),h(B),h(ne),h(re),h(z))}),i(m,"\u0275cmp",T({type:m,selectors:[["app-schedule-edit"]],standalone:!0,features:[O],decls:33,vars:11,consts:[[3,"translucent"],["slot","start"],["defaultHref","/"],[3,"fullscreen"],[3,"ngSubmit","formGroup"],[3,"click"],[1,"ion-text-right"],["class","error-msg ion-padding-start ion-padding-end",4,"ngIf"],["type","number","step","1","label","Duration:","formControlName","duration",1,"ion-text-right"],["type","number","step","1","label","Relay position:","formControlName","relay_position",1,"ion-text-right"],["justify","space-between","formControlName","active"],["expand","block","type","submit","color","danger"],[1,"error-msg","ion-padding-start","ion-padding-end"]],template:function(r,e){r&1&&(n(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),_(3,"ion-back-button",2),o(),n(4,"ion-title"),l(5),o()()(),n(6,"ion-content",3)(7,"form",4),I("ngSubmit",function(){return e.onSubmit()}),n(8,"ion-list")(9,"ion-item-group")(10,"ion-item",5),I("click",function(){return e.openStartTimePicker()}),n(11,"ion-label"),l(12,"Start time:"),o(),n(13,"ion-label",6),l(14),o()(),y(15,se,2,0,"div",7),n(16,"ion-item"),_(17,"ion-input",8),o(),y(18,me,2,0,"div",7),n(19,"ion-item",5),I("click",function(){return e.openRepeatPicker()}),n(20,"ion-label"),l(21,"Repeat:"),o(),n(22,"ion-label",6),l(23),N(24,"displayString"),o()(),n(25,"ion-item"),_(26,"ion-input",9),o(),y(27,ue,2,0,"div",7),n(28,"ion-item")(29,"ion-toggle",10),l(30,"Active"),o()()()(),n(31,"ion-button",11),l(32,"SAVE"),o()()()),r&2&&(g("translucent",!0),u(5),x("",e.id?"Edit":"Create"," schedule"),u(),g("fullscreen",!0),u(),g("formGroup",e.addEditForm),u(7),k(e.addEditForm==null||e.addEditForm.controls==null||e.addEditForm.controls.start_time==null?null:e.addEditForm.controls.start_time.value),u(),g("ngIf",e.addEditForm.controls==null||e.addEditForm.controls.start_time==null?null:e.addEditForm.controls.start_time.errors),u(3),g("ngIf",e.addEditForm.controls==null||e.addEditForm.controls.duration==null?null:e.addEditForm.controls.duration.errors),u(5),k(R(24,9,e.addEditForm==null||e.addEditForm.controls==null||e.addEditForm.controls.repeat==null?null:e.addEditForm.controls.repeat.value)),u(4),g("ngIf",e.addEditForm.controls==null||e.addEditForm.controls.relay_position==null?null:e.addEditForm.controls.relay_position.errors))},dependencies:[V,D,H,$,M,A,q,L,w,W,ie,Q,J,te,U,ee,Y,X,Z,K,oe,ae],styles:[".error-msg[_ngcontent-%COMP%]{color:var(--ion-color-danger);font-size:12px}"],changeDetection:0}));let a=m;return a})();export{ke as ScheduleEditPage};
